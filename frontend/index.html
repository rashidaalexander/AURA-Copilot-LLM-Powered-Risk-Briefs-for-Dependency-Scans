<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AURA Copilot</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 980px; margin: 36px auto; padding: 0 16px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .card { border: 1px solid #ddd; border-radius: 14px; padding: 16px; margin: 14px 0; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid #ccc; }
    pre { white-space: pre-wrap; word-break: break-word; margin:0; }
    textarea { width: 100%; min-height: 220px; }
    button { padding: 10px 14px; border-radius: 12px; border: 1px solid #ccc; cursor: pointer; }
    .big { font-size: 22px; font-weight: 750; }
  </style>
</head>
<body>
  <h1>AURA Copilot</h1>
  <p class="pill">Defensive • OSV Scan • LLM Executive Brief • Docker Deploy</p>

  <div class="card">
    <div class="row">
      <input id="file" type="file" />
      <button id="scan">Scan</button>
      <button id="brief">Scan + Brief</button>
      <span id="status" class="pill">Idle</span>
    </div>
    <p style="margin-top:10px;">Upload <b>requirements.txt</b>, <b>pyproject.toml</b>, or <b>package-lock.json</b>.</p>
  </div>

  <div class="card">
    <div class="row">
      <div class="big">Risk Score:</div>
      <div id="score" class="big">—</div>
    </div>
    <h3>Executive brief</h3>
    <textarea id="briefOut" placeholder="Run Scan + Brief to generate an LLM summary..."></textarea>
  </div>

  <div class="card">
    <h3>Raw JSON</h3>
    <pre id="out">{}</pre>
  </div>

  <script>
    const API = (location.hostname === "localhost") ? "http://localhost:8000" : "";
    const statusEl = document.getElementById("status");
    const outEl = document.getElementById("out");
    const scoreEl = document.getElementById("score");
    const briefOut = document.getElementById("briefOut");

    async function postFile(endpoint) {
      const f = document.getElementById("file").files[0];
      if (!f) { alert("Pick a file first."); return null; }
      const fd = new FormData();
      fd.append("file", f);
      const res = await fetch(`${API}${endpoint}`, { method: "POST", body: fd });
      return await res.json();
    }

    document.getElementById("scan").onclick = async () => {
      statusEl.textContent = "Scanning…";
      scoreEl.textContent = "…";
      briefOut.value = "";
      outEl.textContent = "{}";

      const json = await postFile("/scan");
      if (!json) return;

      outEl.textContent = JSON.stringify(json, null, 2);
      if (json.ok) {
        statusEl.textContent = "Done";
        scoreEl.textContent = `${json.risk_score}/100`;
      } else {
        statusEl.textContent = "Error";
        scoreEl.textContent = "—";
        briefOut.value = json.error || "Unknown error";
      }
    };

    document.getElementById("brief").onclick = async () => {
      statusEl.textContent = "Scanning + Briefing…";
      scoreEl.textContent = "…";
      briefOut.value = "Generating executive brief…";
      outEl.textContent = "{}";

      const json = await postFile("/scan-and-brief");
      if (!json) return;

      outEl.textContent = JSON.stringify(json, null, 2);
      if (json.ok) {
        statusEl.textContent = "Done";
        scoreEl.textContent = `${json.risk_score}/100`;
        briefOut.value = json.executive_brief || "";
      } else {
        statusEl.textContent = "Error";
        scoreEl.textContent = "—";
        briefOut.value = json.error || "Unknown error";
      }
    };
  </script>
</body>
</html>
